<?xml version="1.0" encoding="UTF-8" ?>
<project name="My subsite" default="help">

    <!-- Import production database. -->
    <target name="create-db" description="Create database.">
        <!-- Drop database if exists, create database. -->
        <exec command="echo y | mysqladmin -h${drupal.db.host} -u${drupal.db.user} -p${drupal.db.password} DROP DATABASE IF EXISTS ${drupal.db.name}" logoutput="true" />
        <exec command="mysqladmin -h${drupal.db.host} -u${drupal.db.user} -p${drupal.db.password} CREATE ${drupal.db.name}" logoutput="true" />
    </target>

    <target name="start-container" description="Start docker container">
        <exec executable="/usr/bin/docker">
            <arg value="run" />
            <arg value="--name dev-server" />
            <arg value="-p 127.0.0.1:80:80" />
            <arg value="-v /opt/mysql:/var/lib/mysql" />
            <arg value="-v ${workspace}:/web" />
            <arg value="--env MYSQL_PASSWORD=password" />
            <arg value="-w /web" />
            <arg value="-d" />
            <arg value="dev-server" />
        </exec>
    </target>

    <target name="stop-containers" description="Stop all docker containers and clean up">
        <exec command="docker-compose -f ${subsite.resources.dir}/docker/phpdocker/docker-compose.yml stop; docker rm $(docker ps -aq)" />
    </target>

</project>
